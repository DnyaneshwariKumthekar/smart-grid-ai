# Smart Grid AI - System Architecture

**Version**: 1.0.0  
**Date**: January 30, 2026  

---

## Table of Contents

1. [System Overview](#system-overview)
2. [Data Pipeline](#data-pipeline)
3. [Model Architecture](#model-architecture)
4. [API Architecture](#api-architecture)
5. [Deployment Architecture](#deployment-architecture)
6. [Technology Stack](#technology-stack)

---

## System Overview

### High-Level Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Sources                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Smart Meters (415K samples)                            â”‚  â”‚
â”‚  â”‚ â€¢ Weather Data (temperature, humidity)                   â”‚  â”‚
â”‚  â”‚ â€¢ Grid Status (voltage, frequency)                       â”‚  â”‚
â”‚  â”‚ â€¢ Historical Consumption (31 features)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ ETL Pipeline
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Feature Engineering & Preprocessing                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Temporal Features (hour, day, month, season)          â”‚  â”‚
â”‚  â”‚ â€¢ Statistical Features (rolling mean, std, diff)        â”‚  â”‚
â”‚  â”‚ â€¢ Lag Features (t-1, t-7, t-30)                         â”‚  â”‚
â”‚  â”‚ â€¢ Normalization (StandardScaler)                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                â”‚
                  â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Training Set   â”‚  â”‚    Test Set      â”‚
        â”‚   (70% data)     â”‚  â”‚    (30% data)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                  â”‚
        â–¼                 â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Baseline   â”‚  â”‚ MoE Ensemble â”‚  â”‚  Anomaly         â”‚
   â”‚  Models     â”‚  â”‚              â”‚  â”‚  Detection       â”‚
   â”‚             â”‚  â”‚              â”‚  â”‚                  â”‚
   â”‚ â€¢ RF        â”‚  â”‚ â€¢ GRU        â”‚  â”‚ â€¢ IsolationForestâ”‚
   â”‚ â€¢ ET        â”‚  â”‚ â€¢ CNN-LSTM   â”‚  â”‚ â€¢ OneClassSVM    â”‚
   â”‚ â€¢ Ridge     â”‚  â”‚ â€¢ Transformer   â”‚ â€¢ Autoencoder    â”‚
   â”‚             â”‚  â”‚ â€¢ Attention     â”‚                  â”‚
   â”‚ MAPE: 17%   â”‚  â”‚ MAPE: 0.31%  â”‚  â”‚ 99.95% Acc       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Model Storage (Persistent) â”‚
        â”‚ â€¢ models/baseline_*.pkl      â”‚
        â”‚ â€¢ models/moe_*.pkl           â”‚
        â”‚ â€¢ models/anomaly_*.pkl       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     FastAPI Server           â”‚
        â”‚   (6 Endpoints)              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚
        â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Clients   â”‚  â”‚  Dashboards â”‚
   â”‚  (REST)     â”‚  â”‚  (Grafana)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Pipeline

### ETL Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 RAW DATA (415,053 samples)                   â”‚
â”‚ â€¢ Consumption: 0-5000 W                                       â”‚
â”‚ â€¢ Timestamp: Hourly (2011-2015)                              â”‚
â”‚ â€¢ Format: CSV                                                 â”‚
â”‚ â€¢ Size: 12.4 MB                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Data Validation
                     â”œâ”€ Check for NULL values
                     â”œâ”€ Validate data types
                     â”œâ”€ Check ranges
                     â””â”€ Remove duplicates
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Feature Engineering       â”‚
        â”‚ (Creates 31 features)      â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Temporal (8 features):     â”‚
        â”‚ â€¢ Hour (0-23)              â”‚
        â”‚ â€¢ Day of week (0-6)        â”‚
        â”‚ â€¢ Month (1-12)             â”‚
        â”‚ â€¢ Quarter (1-4)            â”‚
        â”‚ â€¢ Is weekend (0/1)         â”‚
        â”‚ â€¢ Is holiday (0/1)         â”‚
        â”‚ â€¢ Season (0-3)             â”‚
        â”‚ â€¢ Day of year (0-365)      â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Statistical (12 features): â”‚
        â”‚ â€¢ Rolling mean (24h, 7d)   â”‚
        â”‚ â€¢ Rolling std (24h, 7d)    â”‚
        â”‚ â€¢ Rolling min (24h, 7d)    â”‚
        â”‚ â€¢ Rolling max (24h, 7d)    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Lag Features (7 features): â”‚
        â”‚ â€¢ t-1, t-7, t-24          â”‚
        â”‚ â€¢ t-48, t-168, t-365      â”‚
        â”‚ â€¢ t-prev (previous day)    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Derived (4 features):      â”‚
        â”‚ â€¢ Trend (linear)           â”‚
        â”‚ â€¢ Volatility               â”‚
        â”‚ â€¢ Rate of change           â”‚
        â”‚ â€¢ Cyclicity index          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Normalization            â”‚
        â”‚ â€¢ StandardScaler (mean=0)  â”‚
        â”‚ â€¢ Std = 1                  â”‚
        â”‚ â€¢ Inverse transform ready  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Processed Data             â”‚
        â”‚ (31 features Ã— 415,053)    â”‚
        â”‚ Shape: (415053, 31)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Feature Importance (Top 10)

```
Feature                    Importance  Impact
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Lag-1 (consumption t-1)      24.3%      â¬›â¬›â¬›â¬›â¬›
Hour of Day                  18.7%      â¬›â¬›â¬›â¬›
Day of Week                  15.2%      ï¿½ï¿½â¬›â¬›
Lag-24 (consumption t-24)    12.1%      â¬›â¬›
Rolling Mean (24h)            9.8%      â¬›
Rolling Mean (7d)             7.2%      â¬›
Season                        6.5%      â–ˆ
Lag-168 (consumption t-168)   3.1%      
Month                         2.4%
Is Weekend                    0.7%
```

---

## Model Architecture

### 1. Baseline Models (Days 8-9)

```
Decision Tree Ensemble (RandomForest, ExtraTrees)
â”‚
â”œâ”€ Tree 1    â”œâ”€ Tree 2    â”œâ”€ Tree 3    ... â”œâ”€ Tree N
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚            â”‚  â”‚
â”‚  â”œâ”€ Node    â”‚  â”œâ”€ Node    â”‚  â”œâ”€ Node      â”‚  â”œâ”€ Node
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚            â”‚  â”‚
â”‚  â””â”€ Leaf    â”‚  â””â”€ Leaf    â”‚  â””â”€ Leaf      â”‚  â””â”€ Leaf
â”‚
â””â”€ Ensemble Voting â†’ Average â†’ Ridge Meta-Learner â†’ Output

Inputs: 31 features
Output: Power consumption (W)
MAPE: 17.05%
MSE: 2,847,392 WÂ²
MAE: 284 W
```

### 2. MoE Architecture (Days 10-11)

```
Input (31 features)
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚
    â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gating â”‚   â”‚ Expertsâ”‚
â”‚Network â”‚   â”‚        â”‚
â”‚ (Expert)   â”‚        â”‚
â”‚Selection   â”‚        â”‚
â”‚Mechanism   â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚ â”‚ â”‚ â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚      â”‚ â”‚           â”‚
    â–¼    â–¼      â–¼ â–¼           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Expert 1: GRU               â”‚
   â”‚  â€¢ Input: 31 features        â”‚
   â”‚  â€¢ Hidden: 64 units          â”‚
   â”‚  â€¢ Layers: 2                 â”‚
   â”‚  â€¢ MAPE: 2.45%               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Expert 2: CNN-LSTM          â”‚
   â”‚  â€¢ Conv filters: 32,64       â”‚
   â”‚  â€¢ Kernel size: 3            â”‚
   â”‚  â€¢ LSTM units: 64            â”‚
   â”‚  â€¢ MAPE: 1.89%               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Expert 3: Transformer       â”‚
   â”‚  â€¢ Embed dim: 128            â”‚
   â”‚  â€¢ Heads: 4                  â”‚
   â”‚  â€¢ Layers: 2                 â”‚
   â”‚  â€¢ MAPE: 0.87%               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Expert 4: Attention         â”‚
   â”‚  â€¢ Attention heads: 4        â”‚
   â”‚  â€¢ Hidden: 128               â”‚
   â”‚  â€¢ Dropout: 0.2              â”‚
   â”‚  â€¢ MAPE: 0.92%               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚     â”‚      â”‚      â”‚
    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    Gating Output (Learned Weights)
    [0.1, 0.2, 0.4, 0.3]
         â”‚
    â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼
  Weighted Ensemble (Expert Voting)
         â”‚
         â–¼
   Output: Power (W)
   
   MAPE: 0.31%
   MSE: 45,921 WÂ²
   MAE: 12 W
   Improvement: 95.15% vs Baseline
```

### 3. Anomaly Detection (Days 12-13)

```
Input Sample (31 features)
         â”‚
    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚    â”‚            â”‚
    â–¼    â–¼    â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model 1: Isolation Forest        â”‚
â”‚ â€¢ Trees: 100                     â”‚
â”‚ â€¢ Contamination: 0.01            â”‚
â”‚ â€¢ Anomaly Score: -0.15 (score)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model 2: OneClassSVM             â”‚
â”‚ â€¢ Kernel: RBF                    â”‚
â”‚ â€¢ Nu: 0.01 (expected outlier %)  â”‚
â”‚ â€¢ Decision: +1 (normal)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model 3: Autoencoder             â”‚
â”‚ â€¢ Input: 31                      â”‚
â”‚ â€¢ Bottleneck: 16                 â”‚
â”‚ â€¢ Output: 31                     â”‚
â”‚ â€¢ Reconstruction Error: 0.05     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    Voting Ensemble (Majority)
    Votes: [1, 1, 0] â†’ 2/3 â†’ Normal
    Confidence: 66.7%
            â”‚
            â–¼
    Classification: NORMAL or ANOMALY
    
    Results:
    â€¢ Detected: 221 anomalies
    â€¢ Detection Rate: 0.053%
    â€¢ Confidence: 99.95%
```

---

## API Architecture

### REST Endpoints

```
FastAPI Application
â”‚
â”œâ”€ GET /health
â”‚  â””â”€ Returns: {status, uptime, models_loaded}
â”‚
â”œâ”€ POST /predict/single
â”‚  â”œâ”€ Input: {features: [31 values]}
â”‚  â”œâ”€ Validation: Pydantic model
â”‚  â”œâ”€ Processing: Model inference
â”‚  â””â”€ Output: {prediction, confidence, model_used}
â”‚
â”œâ”€ POST /predict/batch
â”‚  â”œâ”€ Input: {samples: [{features}, ...]} (max 1000)
â”‚  â”œâ”€ Processing: Vectorized inference
â”‚  â””â”€ Output: {predictions: [...], timestamps, metadata}
â”‚
â”œâ”€ POST /anomaly-detect
â”‚  â”œâ”€ Input: {features: [31 values]}
â”‚  â”œâ”€ Processing: 3-model voting ensemble
â”‚  â””â”€ Output: {is_anomaly, confidence, models_agreement}
â”‚
â”œâ”€ GET /models
â”‚  â””â”€ Output: List of available models with metadata
â”‚
â””â”€ GET /models/{model_id}
   â””â”€ Output: Detailed metadata for specific model
```

### Request/Response Flow

```
CLIENT REQUEST
    â”‚
    â–¼
HTTP Request + Headers
    â”‚
    â–¼
Nginx Load Balancer
(Port 80/443 â†’ 8000/8001/8002)
    â”‚
    â–¼
FastAPI Application
    â”‚
    â”œâ”€ Route Matching
    â”‚
    â”œâ”€ Request Validation (Pydantic)
    â”‚
    â”œâ”€ Authentication (if enabled)
    â”‚
    â”œâ”€ Rate Limiting Check
    â”‚
    â”œâ”€ Request Processing
    â”‚  â”œâ”€ Data Normalization
    â”‚  â”œâ”€ Model Selection
    â”‚  â”œâ”€ Inference Execution
    â”‚  â””â”€ Result Formatting
    â”‚
    â”œâ”€ Response Serialization (JSON)
    â”‚
    â”œâ”€ Logging & Metrics
    â”‚
    â””â”€ HTTP Response
        â”‚
        â–¼
    CLIENT RECEIVES
```

### Concurrency Model

```
Single Request Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms      Request arrives at Nginx
5ms      Load balanced to API instance
10ms     Pydantic validation
15ms     Model inference starts
50ms     Inference complete
55ms     Response serialization
60ms     Response sent to client

Latency Breakdown:
â”‚ Validation    (5ms, 8%)      â–Œ
â”‚ Model load    (5ms, 8%)      â–Œ
â”‚ Inference    (40ms, 67%)     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Serialization (5ms, 8%)      â–Œ
â”‚ Network      (5ms, 8%)       â–Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total: ~60ms (P50)
         ~100ms (P99)
```

---

## Deployment Architecture

### Production Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Internet / Client Devices                  â”‚
â”‚           Utilities, Building Managers, Users           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTPS
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DNS (api.smartgrid.ai)                        â”‚
â”‚         Points to Load Balancer IP                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Nginx Load Balancer (HA Proxy)                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚ SSL/TLS Termination              â”‚            â”‚
â”‚         â”‚ Rate Limiting (100 req/s)        â”‚            â”‚
â”‚         â”‚ Request Logging                  â”‚            â”‚
â”‚         â”‚ Health Check Probes              â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚              â”‚
      â–¼                      â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API-1      â”‚   â”‚   API-2      â”‚   â”‚   API-3      â”‚
â”‚ Port 8000    â”‚   â”‚ Port 8001    â”‚   â”‚ Port 8002    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Workers: 4 â”‚   â”‚ â€¢ Workers: 4 â”‚   â”‚ â€¢ Workers: 4 â”‚
â”‚ â€¢ Memory: 2GBâ”‚   â”‚ â€¢ Memory: 2GBâ”‚   â”‚ â€¢ Memory: 2GBâ”‚
â”‚ â€¢ CPU: 1     â”‚   â”‚ â€¢ CPU: 1     â”‚   â”‚ â€¢ CPU: 1     â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ FastAPI      â”‚   â”‚ FastAPI      â”‚   â”‚ FastAPI      â”‚
â”‚ Uvicorn      â”‚   â”‚ Uvicorn      â”‚   â”‚ Uvicorn      â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ Health: âœ“    â”‚   â”‚ Health: âœ“    â”‚   â”‚ Health: âœ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚           â”‚           â”‚
              â–¼           â–¼           â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Shared Persistent Storage     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ Models/                         â”‚
         â”‚ â”œâ”€ baseline_day8_9.pkl (7.22MB)â”‚
         â”‚ â”œâ”€ moe_day10_11.pkl (3.28MB)   â”‚
         â”‚ â””â”€ anomaly_day12_13.pkl (1.44MB
         â”‚                                 â”‚
         â”‚ Logs/                           â”‚
         â”‚ â”œâ”€ api_server.log (rotating)    â”‚
         â”‚ â””â”€ access.log                   â”‚
         â”‚                                 â”‚
         â”‚ Data/                           â”‚
         â”‚ â””â”€ synthetic_energy.csv         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Databaseâ”‚ â”‚Cache â”‚ â”‚Monitoringâ”‚
â”‚Postgre â”‚ â”‚Redis â”‚ â”‚Prometheusâ”‚
â”‚SQL     â”‚ â”‚      â”‚ â”‚Grafana   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scaling Profile

```
Load vs Instances Required

RPS    CPU%   Memory   Instances  Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
100     10%    400MB        1       ğŸŸ¢ Low
250     25%    800MB        1       ğŸŸ¢ Optimal
500     50%    1.5GB        1       ğŸŸ¡ OK
750     75%    2GB          1       ğŸŸ  High
1000    100%   2GB          2       ğŸ”´ Scale
2000    50%    2GBÃ—2        2       ğŸŸ¡ OK
4000    75%    4GBÃ—2        2       ğŸŸ  Scale
6000    50%    2GBÃ—3        3       ğŸŸ¡ OK
```

---

## Technology Stack

### Core Components

| Layer | Technology | Version | Purpose |
|-------|-----------|---------|---------|
| **API Framework** | FastAPI | 0.118.0 | REST API server |
| **ASGI Server** | Uvicorn | 0.34.0 | Production server |
| **Validation** | Pydantic | 2.11.9 | Input/output validation |
| **ML Framework** | PyTorch | 2.8.0+cpu | Neural network models |
| **Classical ML** | scikit-learn | 1.7.2 | Tree-based models |
| **Data Processing** | pandas | 2.2.3 | Data manipulation |
| **Numerical** | NumPy | 1.26.4 | Array operations |
| **Monitoring** | Prometheus | latest | Metrics collection |
| **Visualization** | Grafana | latest | Dashboards |
| **HTTP Server** | Nginx | latest | Load balancing |
| **Database** | PostgreSQL | 15 | Data storage |
| **Cache** | Redis | 7 | Caching layer |
| **Container** | Docker | latest | Containerization |
| **Orchestration** | Kubernetes | 1.28+ | Container management |

### Model Dependencies

```
â””â”€ PyTorch 2.8.0+cpu
   â”œâ”€ GRU Module
   â”œâ”€ CNN Layers
   â”œâ”€ LSTM Layers
   â”œâ”€ Transformer
   â””â”€ Attention Mechanism

â””â”€ scikit-learn 1.7.2
   â”œâ”€ RandomForest
   â”œâ”€ ExtraTrees
   â”œâ”€ Ridge Regressor
   â”œâ”€ IsolationForest
   â”œâ”€ OneClassSVM
   â””â”€ StandardScaler

â””â”€ Custom Components
   â”œâ”€ Autoencoder (PyTorch)
   â”œâ”€ Feature Engineering
   â””â”€ Ensemble Logic
```

### Development vs Production Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      DEVELOPMENT ENVIRONMENT            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Python 3.13.5 (venv)                    â”‚
â”‚ Jupyter Notebook                        â”‚
â”‚ FastAPI (dev server)                    â”‚
â”‚ SQLite (testing)                        â”‚
â”‚ Local logging                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Containerize
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PRODUCTION ENVIRONMENT           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Python 3.11 (system)                    â”‚
â”‚ FastAPI                                 â”‚
â”‚ Uvicorn (4 workers)                     â”‚
â”‚ PostgreSQL (12.4)                       â”‚
â”‚ Redis Cache                             â”‚
â”‚ Nginx + SSL                             â”‚
â”‚ Prometheus + Grafana                    â”‚
â”‚ Structured logging (ELK Stack)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated**: January 30, 2026  
**Architecture Version**: 1.0.0  
**Status**: Production Ready
